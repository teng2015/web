<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>邮箱绑定空白页取参数</title>
	<script src="../js/libs/jquery.js"></script>
	
	<script type="text/javascript">
	$(function (){
		function getUrlParam(name)
			{
			var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
			var r = window.location.search.substr(1).match(reg);  //匹配目标参数
			if (r!=null) return unescape(r[2]); return null; //返回参数值
			} 
			var ekey=getUrlParam('eKey');
			var evalue=getUrlParam('eValue');

			
			var eToken = localStorage.token;
			console.log(eToken);
			var bindJson = {
				eKey:ekey,
				eValue:evalue

			};

			if(eToken!=undefined){

				if(ekey && evalue){
				
					ngCom.ngAjax({
						url:"/sec/email/site/",
						data:bindJson,
						method:'put',
						ngHttp:$http,
						success:function(response){
							if(response.result=='success'){

								/*$('.layer').show();
								$('.bind').html('重新绑定');
								setTimeout(function (){
									$('.layer').hide();
								},3000);*/

								setTimeout(function (){
									window.location.href="http://101.201.46.3:8080/page/index.html#/securitySet";
								},2000);
							}
							
						},
						error:function (data){
							console.log(data);
						},

						errfn:function(data){
							
							console.log(data);
							console.log(data.message);
							
							
						}
					});

				}else if(eKey){
				
				/*ngCom.ngAjax({
					url:"/sec/email/link/",
					data:json,
					method:'post',
					ngHttp:$http,
					success:function(response){},
					error:function (){}
				});*/

				}
			}else{
				
				window.location.href="/index.html";
			}
		
		
	});
	</script>
</head>
<body>
	
</body>
</html>